(()=>{function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function t(t){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?e(Object(o),!0).forEach(function(e){n(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function n(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}console.log("Loading jExperience extended tracker..."),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise((n,i)=>{if(window.wem&&"function"==typeof window.wem.init)return n(window.wem);const o=Date.now(),r=()=>Date.now()-o>e?i(new Error("Timeout waiting for window.wem.init")):window.wem&&"function"==typeof window.wem.init?n(window.wem):void setTimeout(r,t);r()})}().then(()=>{const e=window.wem||{};window.wem=t(t({},e),{},{scrollDepthReached:{},pageViewStartTime:Date.now(),visibleTime:0,lastVisibilityChange:Date.now(),isPageVisible:!0,queue:[],batchSize:10,readDepthMarkers:{},contentVisibilitySelectors:[".track-visibility","article",".product",".hero",".cta"],downloadFileTypes:["pdf","doc","docx","xls","xlsx","ppt","pptx","zip","rar","exe","dmg"],trackEvent:(e,t,n)=>{const i=window.wem.buildEvent(e,n?window.wem.buildTarget(n.id||n.className,n.tagName.toLowerCase()):window.wem.buildTarget("page","body"),window.wem.buildSourcePage());t&&(i.properties=i.properties||{},Object.keys(t).forEach(e=>{i.properties[e]=t[e]})),window.wem.queue?window.wem.queue.push(i):console.warn("jExperience tracker not initialized, event queued:",i),window.wem.queue.length>=window.wem.batchSize&&window.wem.processBatch()},processBatch:()=>{if(window.wem.queue&&window.wem.queue.length>0){const e=window.wem.queue.splice(0,window.wem.batchSize);window.wem.collectEvents({events:e})}},initExtendedTracker:function(){document.addEventListener("visibilitychange",window.wem._handleVisibilityChange),window.wem._registerCallback(()=>{window.wem._setupContentVisibilityTracking(),window.wem._detectScrollDepth(.25,()=>window.wem.trackEvent("scrollDepth",{depth:"25%"})),window.wem._detectScrollDepth(.5,()=>window.wem.trackEvent("scrollDepth",{depth:"50%"})),window.wem._detectScrollDepth(.75,()=>window.wem.trackEvent("scrollDepth",{depth:"75%"})),window.wem._detectScrollDepth(.9,()=>window.wem.trackEvent("scrollDepth",{depth:"90%"})),window.wem._setupReadDepthTracking(),window.wem._setupMediaInteractionTracking(),window.wem._setupDownloadTracking(),window.wem._setupCopyActionTracking(),setInterval(window.wem.processBatch,3e3)},"jExperience extended tracker fully loaded",121)},_handleVisibilityChange:()=>{const e=Date.now();if(document.hidden){if(window.wem.isPageVisible){const t=e-window.wem.lastVisibilityChange;window.wem.visibleTime+=t,window.wem.isPageVisible=!1,window.wem._sendTimeOnPageEvent(window.wem.visibleTime)}}else window.wem.isPageVisible=!0;window.wem.lastVisibilityChange=e},_sendTimeOnPageEvent:e=>{window.wem.trackEvent("timeOnPage",{activeTime:e,activeTimeSeconds:Math.floor(e/1e3),totalTime:Date.now()-window.wem.pageViewStartTime,totalTimeSeconds:Math.floor((Date.now()-window.wem.pageViewStartTime)/1e3),sessionStartTime:window.wem.pageViewStartTime,lastVisibilityChange:window.wem.lastVisibilityChange,isVisible:window.wem.isPageVisible}),window.wem.processBatch()},_trackTimeOnPage:()=>{let e=window.wem.visibleTime;window.wem.isPageVisible&&(e+=Date.now()-window.wem.lastVisibilityChange),window.wem._sendTimeOnPageEvent(e)},_setupContentVisibilityTracking:()=>{const e=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const n=t.target;window.wem.trackEvent("contentVisible",{},n),e.unobserve(n)}})},{threshold:.5});window.wem.contentVisibilitySelectors.forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.dataset.wemObserved||(e.observe(t),t.dataset.wemObserved="true")})}),new MutationObserver(t=>{t.forEach(t=>{t.addedNodes.forEach(t=>{1===t.nodeType&&(window.wem.contentVisibilitySelectors.some(e=>t.matches&&t.matches(e))&&(t.dataset.wemObserved||(e.observe(t),t.dataset.wemObserved="true")),window.wem.contentVisibilitySelectors.forEach(n=>{t.querySelectorAll&&t.querySelectorAll(n).forEach(t=>{t.dataset.wemObserved||(e.observe(t),t.dataset.wemObserved="true")})}))})})}).observe(document.body,{childList:!0,subtree:!0})},_detectScrollDepth:(e,t)=>{const n=()=>{const n=document.documentElement.scrollHeight-window.innerHeight;(window.scrollY||document.documentElement.scrollTop)/n>=e&&!window.wem.scrollDepthReached[e]&&(window.wem.scrollDepthReached[e]=!0,t())};window.addEventListener("scroll",n,{passive:!0}),n()},_setupReadDepthTracking:()=>{const e=document.querySelector("article, .content, main")||document.body,t=e.scrollHeight,n=[.2,.4,.6,.8,1],i=()=>{const i=window.innerHeight,o=window.scrollY||document.documentElement.scrollTop,r=o+e.getBoundingClientRect().top;if(o>=r){const d=Math.min(o+i-r,t)/t;n.forEach(t=>{d>=t&&!window.wem.readDepthMarkers[t]&&(window.wem.readDepthMarkers[t]=!0,window.wem.trackEvent("readDepth",{depth:"".concat(Math.round(100*t),"%")},e))})}};window.addEventListener("scroll",i,{passive:!0}),i()},_setupMediaInteractionTracking:()=>{const e=document.querySelectorAll("video, audio"),t=e=>{if(e.dataset.trackingInitialized)return;const t=e.currentSrc||e.src||null,n=e.title||e.getAttribute("aria-label")||null,i={25:!1,50:!1,75:!1};e.addEventListener("play",()=>{window.wem.trackEvent("mediaPlay",{mediaSrc:t,mediaTitle:n,currentTime:Math.round(e.currentTime)},e)}),e.addEventListener("pause",()=>{e.ended||window.wem.trackEvent("mediaPause",{mediaSrc:t,mediaTitle:n,currentTime:Math.round(e.currentTime),duration:Math.round(e.duration)||null})}),e.addEventListener("ended",()=>{window.wem.trackEvent("mediaComplete",{mediaSrc:t,mediaTitle:n,duration:Math.round(e.duration)||null})}),e.addEventListener("timeupdate",()=>{if(e.duration){const o=Math.floor(e.currentTime/e.duration*100);[25,50,75].forEach(r=>{o>=r&&!i[r]&&(i[r]=!0,window.wem.trackEvent("mediaProgress",{mediaSrc:t,mediaTitle:n,progress:"".concat(r,"%"),currentTime:Math.round(e.currentTime),duration:Math.round(e.duration)}))})}}),e.dataset.trackingInitialized="true"};e.forEach(t),new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&(["VIDEO","AUDIO"].includes(e.tagName)&&t(e),e.querySelectorAll&&e.querySelectorAll("video, audio").forEach(t))})})}).observe(document.body,{childList:!0,subtree:!0})},_setupDownloadTracking:()=>{const e=e=>{if(e.hasAttribute("download"))return!0;if(e.href){const t=e.href.toLowerCase();return window.wem.downloadFileTypes.some(e=>t.endsWith("."+e))}return!1},t=e=>{const t=e.currentTarget,n=t.download||t.href.split("/").pop()||"unknown",i=n.split(".").pop()||"unknown";window.wem.trackEvent("download",{filename:n,fileType:i,href:t.href,linkText:t.innerText||t.textContent||null},t)};document.querySelectorAll("a").forEach(n=>{e(n)&&!n.dataset.downloadTracked&&(n.addEventListener("click",t),n.dataset.downloadTracked="true")}),new MutationObserver(n=>{n.forEach(n=>{n.addedNodes.forEach(n=>{1===n.nodeType&&("A"===n.tagName&&e(n)&&!n.dataset.downloadTracked&&(n.addEventListener("click",t),n.dataset.downloadTracked="true"),n.querySelectorAll&&n.querySelectorAll("a").forEach(n=>{e(n)&&!n.dataset.downloadTracked&&(n.addEventListener("click",t),n.dataset.downloadTracked="true")}))})})}).observe(document.body,{childList:!0,subtree:!0})},_setupCopyActionTracking:()=>{document.addEventListener("copy",()=>{var e;const t=(null===(e=window.getSelection())||void 0===e?void 0:e.toString().substring(0,2e3))||"";let n="body";if(window.getSelection&&window.getSelection().rangeCount>0){const e=window.getSelection().getRangeAt(0).commonAncestorContainer,i=1===e.nodeType?e:e.parentElement;i&&(i.closest("article")?n="article":i.closest("pre, code")?n="code":i.closest("table")?n="table":i.closest("p, h1, h2, h3, h4, h5, h6")&&(n="text"),window.wem.trackEvent("contentCopy",{textLength:t.length,textPreview:t.length>0?t:null,copySource:n},i))}})},collectEvents:function(e){if(navigator.sendBeacon){const t=window.wem.contextServerUrl+"/eventcollector";if(!t)return console.warn("jExperience tracker: No endpoint URL found in digitalData"),!1;const n={events:e.events||[],sessionId:window.wem.getSessionId()||this.getCookie(window.digitalData.wemInitConfig.trackerSessionIdCookieName)};return window.wem.consent&&(n.consent=window.wem.consent),!!navigator.sendBeacon(t,new Blob([JSON.stringify(n)],{type:"application/json"}))||this._sendEventsXHR(t,n)}return this._sendEventsXHR(window.wem.contextServerUrl+"/eventcollector",e)},_sendEventsXHR:function(e,t){try{const n=new XMLHttpRequest;return n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json"),n.withCredentials=!0,n.send(JSON.stringify(t)),!0}catch(e){return console.error("Failed to send events via XHR:",e),!1}}}),console.log("Loaded jExperience extended tracker...")}).catch(e=>{console.error("Failed to initialize extended tracker:",e.message)})})();